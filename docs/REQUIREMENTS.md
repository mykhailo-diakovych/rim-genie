# Rim Genie — Product Requirements

> Sources: _Rim Genie Functional Requirements - Legacy.pdf_ + _Rim Genie Upgrade Request - 2025-11-08.pdf_

---

## Business Context

Rim Genie is a **rim repair warehouse** in Jamaica. The platform manages:

- Walk-in customer quoting and job intake (Floor Manager)
- Payment processing and receipts (Cashier)
- Job execution tracking with proof-of-work (Technician)
- Overnight inventory verification (Inventory Clerk)
- System-wide configuration, reporting, and multi-site management (Admin)

Phone numbers default to Jamaican prefix **+1 876**.

---

## User Roles & Device Targets

| Role            | Module         | Devices                        |
| --------------- | -------------- | ------------------------------ |
| Floor Manager   | Floor Manager  | Desktop, Tablet                |
| Cashier         | Cashier        | Desktop (tablet in rare cases) |
| Technician      | Technician     | Tablet only                    |
| Inventory Clerk | Inventory      | Tablet, Mobile                 |
| System Admin    | Administration | Desktop, Tablet, Mobile        |

All roles must authenticate before accessing the platform. Users land on a role-specific dashboard after login.

> Note: Cashier tablet support originates from Admin module spec (Legacy 2.5.1 viii): _"The cashier must be able to use their module on both desktop and in rare cases a tablet."_

---

## Module Specifications

### 2.1 Floor Manager Module

**Purpose:** Generate quotes for walk-in customers, print job tags, route work to cashier.

**Flow:**

1. Search customer by phone number → if not found, create new profile
2. Determine if customer is a VIP and apply appropriate built-in discounts
3. Generate quote (services + pricing from current service catalogue)
4. Optionally send quote to customer via email or SMS (with link to electronic quote)
5. Quote automatically appears in cashier's queue
6. Print job label tag (rack identifier)

**Customer Profile fields:** name, email (optional), phone number, birthday (day + month only — no year for privacy)

**Functional Requirements (Legacy):**

- REQ-1: Add/modify customer profiles
- REQ-2: Add/modify quotes
- REQ-3: Send quotes via email/SMS; email/SMS-enabled quotes include a link to an electronic quote for customer viewing
- REQ-4: Route quote to cashier for payment

> Note: VIP discount determination is described in the module description (Legacy 2.1.1) but was not formally listed as a functional requirement in the original spec. The upgrade request reinforces this as expected behavior.

**SMS Note:** SMS messages may be sent using a provided API endpoint that only requires the contact number and message.

**Upgrade Requests (from client):**

- Search by **name, phone number, OR invoice number** (currently only phone)
- Accounts without email — allow username-only login
- Default phone prefix `1876` (replaceable for non-Jamaican numbers)
- Pricing for welding/reconstruction entered **by inches**
- VIP discount: auto-apply for flagged customers, manual discount input option available for all customers
- "Send to Technician" button must **NOT** be visible to Floor Manager (anti-collusion — Cashier only)

**Security Constraint:**

- Floor Manager must NOT have a "Send to Technician" button — only the Cashier can route jobs to technicians. This prevents collusion between Floor Manager and Technician without work going through Cashier.

---

### 2.2 Cashier Module

**Purpose:** Convert quotes to invoices, record payments, generate receipts, route jobs to technicians.

**Flow:**

1. Quote must have already been generated by the Floor Manager
2. Query customer → select quote → convert to invoice
3. Apply payment (full or partial) to invoice
4. Route job to repair technicians via "Send to Technician" button (exclusive to Cashier)
5. Generate e-receipt (print, email, or SMS)
6. Prompt for follow-up on outstanding payments; auto-notify customer to settle payment before pickup

**Payment Modes:** Credit Card, Debit Card, Online Bank Transfer, Cash, Cheque

**Functional Requirements (Legacy):**

- REQ-1: Record payments against invoices
- REQ-2: Capture payment mode (Credit Card, Debit Card, Online Bank Transfer, Cash, Cheque)
- REQ-3: Full or partial payment support
- REQ-4: Add special notes to the invoice being paid
- REQ-5: Apply discounts (pre-approved by admin) and taxes to invoices. Discount amount must be pre-approved by a system administrator
- REQ-6: Print receipts or send e-receipts via email or SMS

> Note: "Print" = display a browser print preview; user selects printer manually. No direct printer integration required.

**Security:**

- "Send to Technician" button must **only** be visible to Cashier — not Floor Manager (anti-collusion)
- Any change or deletion in the system requires authorization (currently missing in legacy system)

**Upgrade Requests:**

- Receipts via **SMS and email** in addition to print
- Storage fee notice printed at bottom of every receipt: _"Rims left in Rim Genie beyond 30 days will attract a storage fee of $500 daily"_
- Job completion notification routed to **Cashier** (so she can call the customer) in addition to customer SMS

---

### 2.3 Technician Module

**Purpose:** Tablet-based job queue for technicians to accept, track, and complete jobs.

**Flow (Legacy ordering):**

1. View list of incoming jobs → accept job (enter employee number for tracking) — SEQ-1
2. Search for a specific job — SEQ-2
3. Flag job as complete — SEQ-3
4. Upload 30-second proof-of-work video — SEQ-4
5. Auto-notify client of completed job — SEQ-5
6. Input tentative completion date (e.g., due in 5, 10, 15 days → flags as overnight job) — SEQ-6
7. Add special notes — SEQ-7

> Implementation note: Due date input (SEQ-6) will logically occur at job acceptance, before completion — the legacy ordering reflects document structure, not user workflow.

**Key rules:**

- Employee number required at **both** job accept and job complete
- One invoice can be split across multiple technicians (an invoice may have multiple jobs for a single client)
- Jobs with a due date are flagged as **overnight** and tracked by Inventory Clerk

**Functional Requirements (Legacy):**

- REQ-1: Flag jobs as accepted, complete, or set due date. Due date-enabled jobs must be flagged as overnight jobs and will be trackable via the Inventory Clerk
- REQ-2: Add special notes to the job
- REQ-3: Auto-notify customer on completion for pickup via Email/SMS

**Upgrade Requests:**

- Job completion notification routed to **Cashier** (so she calls customer) **and** SMS to customer
- Jobs organized/filterable **by Technician** (currently scattered — add a technician tab or filter)

---

### 2.4 Inventory Management Module

**Purpose:** Track overnight jobs and verify rim inventory at start/end of business day.

**Scope:** All jobs that were invoiced and paid should be available to the inventory manager — not just overnight jobs. The primary workflow focuses on overnight job tracking and daily verification.

**Flow:**

1. End of day: verify all unfinished jobs (not flagged as complete), record total rims/inventory count
2. Start of day: verify inventory against previous day's closing record, flag discrepancies
3. Notify admin of any discrepancies
4. Add special notes

**Functional Requirements (Legacy):**

- REQ-1: Track overnight jobs
- REQ-2: Record and reconcile daily inventory (EOD count → SOD verification → discrepancy flagging)
- REQ-3: Dispatch discrepancy notifications to system administrator

---

### 2.5 System Administration Module

**Purpose:** Configure the system, manage staff, run reports, track all jobs, **view invoices/payments**, and manage financials. Must be accessible remotely without physically being on site.

**Capabilities:**

- Add/edit services and pricing (must be reflected in quote generation options immediately)
- Create and manage VIP clients (auto-discount) — upgrade existing customers to VIP with automatic discounts
- Approve discount requests from Floor Manager
- Add/remove team members (staff accounts)
- Remove customers — system must validate that customer has no invoices or jobs on their profile before deletion (those must be deleted first)
- All staff clock in/out for attendance tracking
- Record expenses
- **View invoices and payments**
- Generate daily reports: expenses, revenue, quotes, invoices
- Multi-site support (switch dashboard between locations)
- Setup user accounts, assign roles, and reset passwords

**Dashboard Requirements:**

- Viewable from any device (desktop/tablet/mobile)
- Shows: recent jobs, invoices, technician assignments, work area where job is being conducted, job status

**Functional Requirements (Legacy):**

- REQ-1: System-wide settings management and general report generation
- REQ-2: Job monitoring dashboard — must identify: job ID, technician, work area, and job status

**Security (from Upgrade Request):**

- Authorization required before any change or deletion in the system (currently missing — no authorization requirement exists in legacy system)

---

### 2.6 Authentication Module

All team members must be authenticated before being granted access to the platform.

**Flow:**

1. Enter username + password/PIN
2. Presented with dashboard of available features based on their role

> Note: The legacy PDF section 2.6.3 lists "Functional Requirements" as a heading but does not enumerate any specific requirements — it immediately transitions to the Loyalty module. Auth requirements are implied by the event sequences above but were never formally listed.

**Upgrade Requests:**

- Support accounts without email (username-only login)
- Authorization required before any change or deletion (system-wide security enhancement)

---

### 2.7 Loyalty Program & Birthday Module

**Purpose:** Track customer purchase frequency and birthdays for loyalty eligibility.

**Access scope:** The legacy spec states _"Users with access to customer profile"_ should see loyalty data. This means loyalty/birthday information should surface within **any module that displays customer profiles** (Floor Manager, Cashier, Admin) — not only as a standalone view.

**Flow:**

- Search customer by mobile number → display profile summary: recent purchases, total purchases, birthday (day/month)

> Note: Only day and month of birthday stored — year intentionally excluded for privacy.

**Functional Requirements (Legacy):**

- REQ-1: Track customer frequency of purchases
- REQ-2: Track customer birthdays (day/month only)

**Loyalty eligibility:** Frequent customers may be eligible to be part of a loyalty program (thresholds and benefits to be configured by admin).

---

### 2.8 Digital Disclaimer / Customer Signature (Stage 3)

**Purpose:** Interactive tablet-based disclaimer that customers sign before service. Saved under customer profile.

**Behavior:**

- Broken into sections — customer signs **only** the sections applicable to their service
- Captured on tablet screen via signature pad, saved to customer profile

**Disclaimer sections:**

1. **Tire/Center Cap Damage** — pre-existing dry rot, crystallization, aging, warehoused tires, low tire pressure driving; Rim Genie not liable. Thorough inspection performed but cannot guarantee detection of such issues.
2. **Scratches/Discoloration** — heating process to restore rim structure may cause slight color, surface discoloration, or burning; Rim Genie not liable.
3. **Lug Nut/Stud Damage** — Rim Genie not responsible for damage during removal of lug nuts and studs.
4. **Welding Warranty** — 1-month warranty on welds for rims that are completely straightened. Voided if rim is out of round or bent. Does not cover structural or cosmetic imperfections. Excludes commercial and public passenger vehicles.
5. **Diamond Cutting Variations** — slight appearance differences if not all 4 rims cut simultaneously. Recommend cutting all 4 at once for consistent finish. Rim Genie not responsible for perceived differences if only some rims undergo diamond cutting.
6. **General Inspection Limitation** — visual and structural inspection performed, but underlying conditions or latent defects may not be immediately visible. Customer acknowledges and accepts these limitations.
7. **Acknowledgment** — _"By signing, you acknowledge that you have read, understood and agreed to the terms outlined."_

---

## Known Bugs in Legacy System (from client — Stage 1)

### Functional Bugs

| #   | Bug                                                                               | Severity |
| --- | --------------------------------------------------------------------------------- | -------- |
| 1   | Floor manager entries require page refresh to appear in technician/cashier queues | High     |
| 2   | Invoice/receipt items after the 4th don't print                                   | High     |
| 3   | Initial page comment not shown when printed                                       | Medium   |
| 4   | Save button in quotations screen duplicates invoice with new number               | High     |
| 5   | New services added to invoice not visible when reopening invoice                  | High     |
| 6   | "Partially Accept" button no longer appears                                       | High     |
| 7   | Manage Price entries not reflected in quote generation options                    | High     |
| 8   | "Other welding" options on quotation screen not appearing on receipt              | Medium   |

### Performance Issues

| #   | Issue                                                   | Severity |
| --- | ------------------------------------------------------- | -------- |
| P   | Slight delay in processing when signing into the system | Low      |

---

## UI/UX Label Corrections (from client — Stage 1)

| Screen    | Current Label                         | Correct Label                                                                    |
| --------- | ------------------------------------- | -------------------------------------------------------------------------------- |
| General   | Rim Type: Off the Market / Factory    | Side of vehicle rim removed from                                                 |
| Rotors    | Vehicle size options                  | Sedan/Small Cars · Mid-Size SUV/Pick-up · Full-Size SUV/Pick-up                  |
| Tire Work | "Remove and Repair Rim"               | "Remove and Replace"                                                             |
| Polishing | "Number of Polishing"                 | "Area to be Polished: Lip / Face / Spot Polish"                                  |
| General   | "Hide Meaning" element                | Remove or clarify — users do not understand its purpose                          |
| Receipt   | Row size (only ~4 items per page)     | Reduce row height — target **8 services minimum** per page (or maximum possible) |
| Receipt   | Address section positioned below logo | Move address **beside** logo to save vertical space and reduce paper usage       |

---

## Notification & Communication

**Channels:**

- **SMS:** via provided external API endpoint (requires phone number + message only). Confirm with client whether this is an existing gateway or if a provider (e.g., Twilio) needs to be integrated.
- **Email:** transactional email delivery (quotes, receipts, notifications)

**Notification Triggers:**

| Trigger                            | Recipients                                                                        | Channel                                         |
| ---------------------------------- | --------------------------------------------------------------------------------- | ----------------------------------------------- |
| Quote sent                         | Customer                                                                          | Email and/or SMS                                |
| Job completed                      | Customer + Cashier                                                                | SMS to customer; in-app notification to Cashier |
| Outstanding payment reminder       | Customer                                                                          | Email and/or SMS                                |
| Payment due before pickup          | Customer (auto-triggered when job is complete but payment is partial/outstanding) | Email and/or SMS                                |
| Inventory discrepancy              | System Administrator                                                              | In-app notification                             |
| Discount request submitted         | System Administrator                                                              | In-app notification                             |
| Discount request approved/rejected | Floor Manager                                                                     | In-app notification                             |

---

## Multi-Site

Admin dashboard can switch between different physical site locations. All data (jobs, invoices, customers, inventory) is scoped or filterable per site.

---

## Technical Stack

### Confirmed Stack

| Layer              | Technology       | Notes                                                  |
| ------------------ | ---------------- | ------------------------------------------------------ |
| Frontend framework | TanStack Start   | SSR useful for public electronic quote viewer link     |
| Data fetching      | TanStack Query   | API state management; polling fallback for real-time   |
| Forms              | TanStack Form    | Form state + validation                                |
| UI components      | shadcn/ui        | Consistent, responsive component library               |
| Backend API        | oRPC (type-safe) | End-to-end type safety between frontend and backend    |
| Business logic     | Effect TS        | Structured error handling for complex workflows        |
| ORM                | Drizzle ORM      | Type-safe Postgres access, migrations as code          |
| Database           | PostgreSQL       | Relational data model                                  |
| CI/CD              | Azure DevOps     |                                                        |
| Hosting            | Azure            |                                                        |
| Email              | Resend           | Transactional emails (quotes, receipts, notifications) |

### Additional Requirements Not Yet Covered

| Need                   | Recommendation                                                                 | Why                                                                                                                                                  |
| ---------------------- | ------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Real-time updates**  | WebSocket / SSE (e.g., Socket.io, Ably, or Azure Web PubSub)                   | Bug #1: "page refresh required to see new work." TanStack Query polling alone may not be sufficient for the client's expectation of instant updates. |
| **SMS delivery**       | Confirm client's existing SMS API or add Twilio / Azure Communication Services | Legacy spec says "provided API endpoint" — clarify if this is already available or needs to be built.                                                |
| **Video/file storage** | Azure Blob Storage                                                             | 30-second proof-of-work video uploads (~50 MB max). Fits Azure hosting stack.                                                                        |
| **Signature capture**  | `react-signature-canvas` or `signature_pad`                                    | Disclaimer module requires tablet-friendly signature capture.                                                                                        |
| **Print optimization** | `@media print` CSS                                                             | Browser-native print preview. Dedicated print stylesheets for receipts, invoices, job tags. No server-side print generation needed.                  |

---

## External Interface Requirements (Legacy)

The system should interface with any internet-enabled device (laptop, tablet, mobile) via a standard web URL requiring authenticated access. System pages adapt to the following screen sizes:

| Module                       | Desktop | Tablet    | Mobile |
| ---------------------------- | ------- | --------- | ------ |
| Cashier Module               | ✅      | ❌ (rare) | ❌     |
| Floor Manager Module         | ✅      | ✅        | ❌     |
| Inventory Module             | ❌      | ✅        | ✅     |
| Technician Module            | ❌      | ✅        | ❌     |
| System Administration Module | ✅      | ✅        | ✅     |
